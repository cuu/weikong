###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.40338/W32 for 8051         14/Nov/2012  13:29:58 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\ZMain\TI2530DB\ZMain.c                     #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\testApp_2.5\CC2530DB\..\..\..\ #
#                          Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ          #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\Tools\CC2530D #
#                          B\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0           #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Z #
#                          Main\TI2530DB\ZMain.c" -D ZTOOL_P1 -D MT_TASK -D   #
#                          LCD_SUPPORTED=DEBUG -D HAL_UART=TRUE -D xNV_INIT   #
#                          -D NV_RESTORE -D xPOWER_SAVING -D                  #
#                          BUILD_ALL_DEVICES -D HOLD_AUTO_START -D            #
#                          HAL_LED=FALSE -lC "C:\Texas                        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\RouterEB\List\" -lA    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\testApp_2.5\CC2530DB\RouterEB\Lis #
#                          t\" --diag_suppress Pe001,Pa010 -o "C:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\RouterEB\Obj\" -e      #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\testApp_2.5\CC2530DB\" -I      #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\testApp_2.5\CC2530DB\..\Source\"  #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\testApp_2.5\CC2530DB\..\..\..\ #
#                          ZMain\TI2530DB\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\hal\include\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\hal\target\CC2530EB\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\mac\include\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\mac\high_level\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\mac\low_level\srf04\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\mac\low_level\srf04\single_chip\" -I           #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\testApp_2.5\CC2530DB\..\..\..\..\ #
#                          ..\Components\mt\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\osal\include\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\services\saddr\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\services\sdata\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\stack\af\" -I "C:\Texas                        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\stack\nwk\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\stack\sapi\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\stack\sec\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\stack\sys\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\stack\zdo\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\testApp_2.5\CC2530DB\..\..\..\..\..\Compone #
#                          nts\zmac\" -I "C:\Texas Instruments\ZStack-CC2530- #
#                          2.5.1a\Projects\zstack\Samples\testApp_2.5\CC2530D #
#                          B\..\..\..\..\..\Components\zmac\f8w\" -Ohz        #
#                          --require_prototypes                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\testApp_2.5\CC2530DB\RouterEB\List #
#                          \ZMain.lst                                         #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\testApp_2.5\CC2530DB\RouterEB\Obj\ #
#                          ZMain.r51                                          #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\ZMain\TI2530DB\ZMain.c
      1          /**************************************************************************************************
      2            Filename:       ZMain.c
      3            Revised:        $Date: 2010-09-17 16:25:30 -0700 (Fri, 17 Sep 2010) $
      4            Revision:       $Revision: 23835 $
      5          
      6            Description:    Startup and shutdown code for ZStack
      7            Notes:          This version targets the Chipcon CC2530
      8          
      9          
     10            Copyright 2005-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #ifndef NONWK
     46          #include "AF.h"
     47          #endif
     48          #include "hal_adc.h"

   \                                 In  segment SFR_AN, at 0x8f
   \   unsigned char volatile __sfr P0INP
   \                     P0INP:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x9d
   \   unsigned char volatile __sfr SLEEPSTA
   \                     SLEEPSTA:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x9e
   \   unsigned char volatile __sfr CLKCONSTA
   \                     CLKCONSTA:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xbe
   \   unsigned char volatile __sfr SLEEPCMD
   \                     SLEEPCMD:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc6
   \   unsigned char volatile __sfr CLKCONCMD
   \                     CLKCONCMD:
   \   000000                DS 1
     49          #include "hal_flash.h"
     50          #include "hal_lcd.h"
     51          #include "hal_led.h"
     52          #include "hal_drivers.h"
     53          #include "OnBoard.h"
     54          #include "OSAL.h"
     55          #include "OSAL_Nv.h"
     56          #include "ZComDef.h"
     57          #include "ZMAC.h"
     58          
     59          /*********************************************************************
     60           * LOCAL FUNCTIONS
     61           */
     62          
     63          static void zmain_ext_addr( void );
     64          #if defined ZCL_KEY_ESTABLISH
     65          static void zmain_cert_init( void );
     66          #endif
     67          static void zmain_dev_info( void );
     68          static void zmain_vdd_check( void );
     69          
     70          #ifdef LCD_SUPPORTED
     71          static void zmain_lcd_init( void );
     72          #endif
     73          
     74          /*********************************************************************
     75           * @fn      main
     76           * @brief   First function called after startup.
     77           * @return  don't care
     78           */
     79          

   \                                 In  segment XDATA_I, align 1, keep-with-next
     80          uint32 zgDefaultChannelList = DEFAULT_CHANLIST;
   \                     zgDefaultChannelList:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for zgDefaultChannelList>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     81          uint16 zgConfigPANID = ZDAPP_CONFIG_PAN_ID;
   \                     zgConfigPANID:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgConfigPANID>`
   \   000002                REQUIRE __INIT_XDATA_I
     82          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     83          uint8 start_flag=0;
   \                     start_flag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     84          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     85          int main( void )
   \                     main:
     86          {
   \   000000                ; Auto size: 0
     87          
     88            uint16 size;
     89            // Turn off interrupts
     90            osal_int_disable( INTS_ALL );
   \   000000                ; Setup parameters for call to function osal_int_disable
   \   000000   79FF         MOV     R1,#-0x1
   \   000002   12....       LCALL   ??osal_int_disable?relay
     91          
     92            // Initialization for board related stuff such as LEDs
     93            HAL_BOARD_INIT();
   \   000005   53BEFB       ANL     0xbe,#0xfb
   \                     ??main_0:
   \   000008   E59D         MOV     A,0x9d
   \   00000A   A2E6         MOV     C,0xE0 /* A   */.6
   \   00000C   50FA         JNC     ??main_0
   \   00000E   00           NOP
   \   00000F   78F8         MOV     R0,#-0x8
   \   000011   7901         MOV     R1,#0x1
   \                     ??main_1:
   \   000013   00           NOP
   \   000014   E8           MOV     A,R0
   \   000015   24FF         ADD     A,#-0x1
   \   000017   18           DEC     R0
   \   000018   E9           MOV     A,R1
   \   000019   34FF         ADDC    A,#-0x1
   \   00001B   F9           MOV     R1,A
   \   00001C   E8           MOV     A,R0
   \   00001D   49           ORL     A,R1
   \   00001E   70F3         JNZ     ??main_1
   \   000020   75C600       MOV     0xc6,#0x0
   \                     ??main_2:
   \   000023   E59E         MOV     A,0x9e
   \   000025   70FC         JNZ     ??main_2
   \   000027   43BE04       ORL     0xbe,#0x4
   \   00002A   906270       MOV     DPTR,#0x6270
   \   00002D   7408         MOV     A,#0x8
   \   00002F   F0           MOVX    @DPTR,A
   \   000030   438F01       ORL     0x8f,#0x1
     94          
     95            // Make sure supply voltage is high enough to run
     96            zmain_vdd_check();
   \   000033   7E10         MOV     R6,#0x10
   \                     ??main_3:
   \   000035                ; Setup parameters for call to function HalAdcCheckVdd
   \   000035   794A         MOV     R1,#0x4a
   \   000037   12....       LCALL   ??HalAdcCheckVdd?relay
   \   00003A   E9           MOV     A,R1
   \   00003B   60F8         JZ      ??main_3
   \   00003D   1E           DEC     R6
   \   00003E   EE           MOV     A,R6
   \   00003F   70F4         JNZ     ??main_3
     97          
     98            // Initialize board I/O
     99            InitBoard( OB_COLD );
   \   000041                ; Setup parameters for call to function InitBoard
   \   000041   7900         MOV     R1,#0x0
   \   000043   12....       LCALL   ??InitBoard?relay
    100          
    101            // Initialze HAL drivers
    102            HalDriverInit();
   \   000046                ; Setup parameters for call to function HalDriverInit
   \   000046   12....       LCALL   ??HalDriverInit?relay
    103          
    104            // Initialize NV System
    105          
    106            osal_nv_init( NULL );
   \   000049                ; Setup parameters for call to function osal_nv_init
   \   000049   7A00         MOV     R2,#0x0
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   12....       LCALL   ??osal_nv_init?relay
    107            
    108          
    109            size = osal_nv_item_len( ZCD_NV_CHANLIST);
   \   000050                ; Setup parameters for call to function osal_nv_item_len
   \   000050   7A84         MOV     R2,#-0x7c
   \   000052   12....       LCALL   ?Subroutine0 & 0xFFFF
    110            
    111            if( size  <= sizeof(zgDefaultChannelList) && size != 0  )
   \                     ??CrossCallReturnLabel_3:
   \   000055   9405         SUBB    A,#0x5
   \   000057   E9           MOV     A,R1
   \   000058   9400         SUBB    A,#0x0
   \   00005A   5039         JNC     ??main_4
   \   00005C   E8           MOV     A,R0
   \   00005D   49           ORL     A,R1
   \   00005E   6035         JZ      ??main_4
    112            {
    113                osal_nv_item_init( ZCD_NV_CHANLIST, sizeof(zgDefaultChannelList), &zgDefaultChannelList);
   \   000060                ; Setup parameters for call to function osal_nv_item_init
   \   000060   75....       MOV     ?V0 + 0,#zgDefaultChannelList & 0xff
   \   000063   75....       MOV     ?V0 + 1,#(zgDefaultChannelList >> 8) & 0xff
   \   000066   78..         MOV     R0,#?V0 + 0
   \   000068   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006B   7C04         MOV     R4,#0x4
   \   00006D   7D00         MOV     R5,#0x0
   \   00006F   7A84         MOV     R2,#-0x7c
   \   000071   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000074   12....       LCALL   ?DEALLOC_XSTACK8
    114                osal_nv_read(  ZCD_NV_CHANLIST, 0, sizeof(zgDefaultChannelList), &zgDefaultChannelList);
   \   000077                ; Setup parameters for call to function osal_nv_read
   \   000077   78..         MOV     R0,#?V0 + 0
   \   000079   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00007C   75..04       MOV     ?V0 + 0,#0x4
   \   00007F   75..00       MOV     ?V0 + 1,#0x0
   \   000082   78..         MOV     R0,#?V0 + 0
   \   000084   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000087   7C00         MOV     R4,#0x0
   \   000089   7D00         MOV     R5,#0x0
   \   00008B   7A84         MOV     R2,#-0x7c
   \   00008D   12....       LCALL   ?Subroutine3 & 0xFFFF
    115            }else
   \                     ??CrossCallReturnLabel_6:
   \   000090   12....       LCALL   ?DEALLOC_XSTACK8
   \   000093   800C         SJMP    ??main_5
    116            {
    117                zgDefaultChannelList = DEFAULT_CHANLIST;
   \                     ??main_4:
   \   000095   90....       MOV     DPTR,#__Constant_800
   \   000098   12....       LCALL   ?XLOAD_R2345
   \   00009B   90....       MOV     DPTR,#zgDefaultChannelList
   \   00009E   12....       LCALL   ?XSTORE_R2345
    118            }
    119          
    120          
    121            size = osal_nv_item_len( ZCD_NV_PANID);
   \                     ??main_5:
   \   0000A1                ; Setup parameters for call to function osal_nv_item_len
   \   0000A1   7A83         MOV     R2,#-0x7d
   \   0000A3   12....       LCALL   ?Subroutine0 & 0xFFFF
    122            /// 改变 panid ，在启动时
    123            if( size  <= sizeof(zgConfigPANID) && size != 0  )
   \                     ??CrossCallReturnLabel_4:
   \   0000A6   9403         SUBB    A,#0x3
   \   0000A8   E9           MOV     A,R1
   \   0000A9   9400         SUBB    A,#0x0
   \   0000AB   5039         JNC     ??main_6
   \   0000AD   E8           MOV     A,R0
   \   0000AE   49           ORL     A,R1
   \   0000AF   6035         JZ      ??main_6
    124            {
    125                osal_nv_item_init( ZCD_NV_PANID, sizeof(zgConfigPANID), &zgConfigPANID);
   \   0000B1                ; Setup parameters for call to function osal_nv_item_init
   \   0000B1   75....       MOV     ?V0 + 0,#zgConfigPANID & 0xff
   \   0000B4   75....       MOV     ?V0 + 1,#(zgConfigPANID >> 8) & 0xff
   \   0000B7   78..         MOV     R0,#?V0 + 0
   \   0000B9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000BC   7C02         MOV     R4,#0x2
   \   0000BE   7D00         MOV     R5,#0x0
   \   0000C0   7A83         MOV     R2,#-0x7d
   \   0000C2   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   0000C5   12....       LCALL   ?DEALLOC_XSTACK8
    126                osal_nv_read(  ZCD_NV_PANID, 0, sizeof(zgConfigPANID), &zgConfigPANID);
   \   0000C8                ; Setup parameters for call to function osal_nv_read
   \   0000C8   78..         MOV     R0,#?V0 + 0
   \   0000CA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CD   75..02       MOV     ?V0 + 0,#0x2
   \   0000D0   75..00       MOV     ?V0 + 1,#0x0
   \   0000D3   78..         MOV     R0,#?V0 + 0
   \   0000D5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D8   7C00         MOV     R4,#0x0
   \   0000DA   7D00         MOV     R5,#0x0
   \   0000DC   7A83         MOV     R2,#-0x7d
   \   0000DE   12....       LCALL   ?Subroutine3 & 0xFFFF
    127            }else
   \                     ??CrossCallReturnLabel_7:
   \   0000E1   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E4   8008         SJMP    ??main_7
    128            {
    129                zgConfigPANID = ZDAPP_CONFIG_PAN_ID;
   \                     ??main_6:
   \   0000E6   90....       MOV     DPTR,#zgConfigPANID
   \   0000E9   74FF         MOV     A,#-0x1
   \   0000EB   F0           MOVX    @DPTR,A
   \   0000EC   A3           INC     DPTR
   \   0000ED   F0           MOVX    @DPTR,A
    130            }
    131          
    132            size = osal_nv_item_len( 0x0201);
   \                     ??main_7:
   \   0000EE                ; Setup parameters for call to function osal_nv_item_len
   \   0000EE   7A01         MOV     R2,#0x1
   \   0000F0   7B02         MOV     R3,#0x2
   \   0000F2   12....       LCALL   ??Subroutine4_0 & 0xFFFF
    133            
    134            if( size <= sizeof(start_flag) && size != 0 )
   \                     ??CrossCallReturnLabel_5:
   \   0000F5   9402         SUBB    A,#0x2
   \   0000F7   E9           MOV     A,R1
   \   0000F8   9400         SUBB    A,#0x0
   \   0000FA   503D         JNC     ??main_8
   \   0000FC   E8           MOV     A,R0
   \   0000FD   49           ORL     A,R1
   \   0000FE   6039         JZ      ??main_8
    135            {
    136              osal_nv_item_init( 0x0201, sizeof(start_flag), &start_flag);
   \   000100                ; Setup parameters for call to function osal_nv_item_init
   \   000100   75....       MOV     ?V0 + 0,#start_flag & 0xff
   \   000103   75....       MOV     ?V0 + 1,#(start_flag >> 8) & 0xff
   \   000106   78..         MOV     R0,#?V0 + 0
   \   000108   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00010B   7C01         MOV     R4,#0x1
   \   00010D   7D00         MOV     R5,#0x0
   \   00010F   7A01         MOV     R2,#0x1
   \   000111   7B02         MOV     R3,#0x2
   \   000113   12....       LCALL   ??Subroutine6_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000116   12....       LCALL   ?DEALLOC_XSTACK8
    137              osal_nv_read(0x0201,0,  sizeof(start_flag), &start_flag);
   \   000119                ; Setup parameters for call to function osal_nv_read
   \   000119   78..         MOV     R0,#?V0 + 0
   \   00011B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00011E   75..01       MOV     ?V0 + 0,#0x1
   \   000121   75..00       MOV     ?V0 + 1,#0x0
   \   000124   78..         MOV     R0,#?V0 + 0
   \   000126   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000129   7C00         MOV     R4,#0x0
   \   00012B   7D00         MOV     R5,#0x0
   \   00012D   7A01         MOV     R2,#0x1
   \   00012F   7B02         MOV     R3,#0x2
   \   000131   12....       LCALL   ??Subroutine5_0 & 0xFFFF
    138            }else
   \                     ??CrossCallReturnLabel_9:
   \   000134   12....       LCALL   ?DEALLOC_XSTACK8
   \   000137   8005         SJMP    ??main_9
    139            {
    140              start_flag = 0;
   \                     ??main_8:
   \   000139   90....       MOV     DPTR,#start_flag
   \   00013C   E4           CLR     A
   \   00013D   F0           MOVX    @DPTR,A
    141            }
    142            
    143            // Initialize the MAC
    144            ZMacInit();
   \                     ??main_9:
   \   00013E                ; Setup parameters for call to function ZMacInit
   \   00013E   12....       LCALL   ??ZMacInit?relay
    145          
    146            // Determine the extended address
    147            zmain_ext_addr();
   \   000141                ; Setup parameters for call to function zmain_ext_addr
   \   000141   12....       LCALL   ??zmain_ext_addr?relay
    148          
    149          #if defined ZCL_KEY_ESTABLISH
    150            // Initialize the Certicom certificate information.
    151            zmain_cert_init();
    152          #endif
    153          
    154            // Initialize basic NV items
    155            zgInit();
   \   000144                ; Setup parameters for call to function zgInit
   \   000144   12....       LCALL   ??zgInit?relay
    156          
    157          #ifndef NONWK
    158            // Since the AF isn't a task, call it's initialization routine
    159            afInit();
    160          #endif
    161          
    162            // Initialize the operating system
    163            osal_init_system();
   \   000147                ; Setup parameters for call to function osal_init_system
   \   000147   12....       LCALL   ??osal_init_system?relay
    164          
    165            // Allow interrupts
    166            osal_int_enable( INTS_ALL );
   \   00014A                ; Setup parameters for call to function osal_int_enable
   \   00014A   79FF         MOV     R1,#-0x1
   \   00014C   12....       LCALL   ??osal_int_enable?relay
    167          
    168            // Final board initialization
    169            InitBoard( OB_READY );
   \   00014F                ; Setup parameters for call to function InitBoard
   \   00014F   7902         MOV     R1,#0x2
   \   000151   12....       LCALL   ??InitBoard?relay
    170          
    171            // Display information about this device
    172            //zmain_dev_info();
    173          
    174            /* Display the device info on the LCD */
    175          #ifdef LCD_SUPPORTED
    176            zmain_lcd_init();
   \   000154                ; Setup parameters for call to function HalLcdWriteString
   \   000154   7901         MOV     R1,#0x1
   \   000156   7A..         MOV     R2,#`?<Constant "TexasInstruments">` & 0xff
   \   000158   7B..         MOV     R3,#(`?<Constant "TexasInstruments">` >> 8) & 0xff
   \   00015A   12....       LCALL   ??HalLcdWriteString?relay
    177          #endif
    178          
    179          #ifdef WDT_IN_PM1
    180            /* If WDT is used, this is a good place to enable it. */
    181            WatchDogEnable( WDTIMX );
    182          #endif
    183          
    184            osal_start_system(); // No Return from here
   \   00015D                ; Setup parameters for call to function osal_start_system
   \   00015D   12....       LCALL   ??osal_start_system?relay
    185          
    186            return 0;  // Shouldn't get here.
   \   000160   7A00         MOV     R2,#0x0
   \   000162   7B00         MOV     R3,#0x0
   \   000164   02....       LJMP    ?BRET
   \   000167                REQUIRE SLEEPCMD
   \   000167                REQUIRE SLEEPSTA
   \   000167                REQUIRE CLKCONCMD
   \   000167                REQUIRE CLKCONSTA
   \   000167                REQUIRE P0INP
    187          } // main()

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002                REQUIRE ??Subroutine4_0
   \   000002                ; // Fall through to label ??Subroutine4_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   12....       LCALL   ??osal_nv_item_len?relay
   \   000003   8A..         MOV     ?V0 + 0,R2
   \   000005   8B..         MOV     ?V0 + 1,R3
   \   000007   A8..         MOV     R0,?V0 + 0
   \   000009   A9..         MOV     R1,?V0 + 1
   \   00000B   C3           CLR     C
   \   00000C   E8           MOV     A,R0
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7B00         MOV     R3,#0x0
   \   000002                REQUIRE ??Subroutine5_0
   \   000002                ; // Fall through to label ??Subroutine5_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine5_0:
   \   000000   12....       LCALL   ??osal_nv_read?relay
   \   000003   7404         MOV     A,#0x4
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7B00         MOV     R3,#0x0
   \   000002                REQUIRE ??Subroutine6_0
   \   000002                ; // Fall through to label ??Subroutine6_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine6_0:
   \   000000   12....       LCALL   ??osal_nv_item_init?relay
   \   000003   7402         MOV     A,#0x2
   \   000005   22           RET
    188          
    189          /*********************************************************************
    190           * @fn      zmain_vdd_check
    191           * @brief   Check if the Vdd is OK to run the processor.
    192           * @return  Return if Vdd is ok; otherwise, flash LED, then reset
    193           *********************************************************************/
    194          static void zmain_vdd_check( void )
    195          {
    196            uint8 cnt = 16;
    197            
    198            do {
    199              while (!HalAdcCheckVdd(VDD_MIN_RUN));
    200            } while (--cnt);
    201          }
    202          
    203          /**************************************************************************************************
    204           * @fn          zmain_ext_addr
    205           *
    206           * @brief       Execute a prioritized search for a valid extended address and write the results
    207           *              into the OSAL NV system for use by the system. Temporary address not saved to NV.
    208           *
    209           * input parameters
    210           *
    211           * None.
    212           *
    213           * output parameters
    214           *
    215           * None.
    216           *
    217           * @return      None.
    218           **************************************************************************************************
    219           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    220          static void zmain_ext_addr(void)
   \                     zmain_ext_addr:
    221          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    222            uint8 nullAddr[Z_EXTADDR_LEN] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#(`?<Constant {255, 255, 255, 255, 255, 255, 255,` >> 8) & 0xff
   \   000017   7582..       MOV     DPL,#`?<Constant {255, 255, 255, 255, 255, 255, 255,` & 0xff
   \   00001A   7408         MOV     A,#0x8
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    223            uint8 writeNV = TRUE;
    224          
    225            // First check whether a non-erased extended address exists in the OSAL NV.
    226            if ((SUCCESS != osal_nv_item_init(ZCD_NV_EXTADDR, Z_EXTADDR_LEN, NULL))  ||
    227                (SUCCESS != osal_nv_read(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress)) ||
    228                (osal_memcmp(aExtendedAddress, nullAddr, Z_EXTADDR_LEN)))
   \   00001F                ; Setup parameters for call to function osal_nv_item_init
   \   00001F   F5..         MOV     ?V0 + 0,A
   \   000021   F5..         MOV     ?V0 + 1,A
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   7C08         MOV     R4,#0x8
   \   00002A   7D00         MOV     R5,#0x0
   \   00002C   7A01         MOV     R2,#0x1
   \   00002E   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000031   12....       LCALL   ?DEALLOC_XSTACK8
   \   000034   E9           MOV     A,R1
   \   000035   7053         JNZ     ??zmain_ext_addr_0
   \   000037                ; Setup parameters for call to function osal_nv_read
   \   000037   75....       MOV     ?V0 + 0,#aExtendedAddress & 0xff
   \   00003A   75....       MOV     ?V0 + 1,#(aExtendedAddress >> 8) & 0xff
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042   75..08       MOV     ?V0 + 0,#0x8
   \   000045   75..00       MOV     ?V0 + 1,#0x0
   \   000048   78..         MOV     R0,#?V0 + 0
   \   00004A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004D   7C00         MOV     R4,#0x0
   \   00004F   7D00         MOV     R5,#0x0
   \   000051   7A01         MOV     R2,#0x1
   \   000053   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   \   000059   E9           MOV     A,R1
   \   00005A   702E         JNZ     ??zmain_ext_addr_0
   \   00005C                ; Setup parameters for call to function osal_memcmp
   \   00005C   85..82       MOV     DPL,?XSP + 0
   \   00005F   85..83       MOV     DPH,?XSP + 1
   \   000062   A982         MOV     R1,DPL
   \   000064   AA83         MOV     R2,DPH
   \   000066   89..         MOV     ?V0 + 0,R1
   \   000068   8A..         MOV     ?V0 + 1,R2
   \   00006A   75..00       MOV     ?V0 + 2,#0x0
   \   00006D   78..         MOV     R0,#?V0 + 0
   \   00006F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000072   7C08         MOV     R4,#0x8
   \   000074   7D00         MOV     R5,#0x0
   \   000076   79..         MOV     R1,#aExtendedAddress & 0xff
   \   000078   7A..         MOV     R2,#(aExtendedAddress >> 8) & 0xff
   \   00007A   7B00         MOV     R3,#0x0
   \   00007C   12....       LCALL   ??osal_memcmp?relay
   \   00007F   7403         MOV     A,#0x3
   \   000081   12....       LCALL   ?DEALLOC_XSTACK8
   \   000084   E9           MOV     A,R1
   \   000085   7003         JNZ     $+5
   \   000087   02....       LJMP    ??zmain_ext_addr_1 & 0xFFFF
    229            {
    230              // Attempt to read the extended address from the location on the lock bits page
    231              // where the programming tools know to reserve it.
    232              HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_IEEE_OSET, aExtendedAddress, Z_EXTADDR_LEN);
   \                     ??zmain_ext_addr_0:
   \   00008A                ; Setup parameters for call to function HalFlashRead
   \   00008A   75..08       MOV     ?V0 + 0,#0x8
   \   00008D   75..00       MOV     ?V0 + 1,#0x0
   \   000090   78..         MOV     R0,#?V0 + 0
   \   000092   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000095   7C..         MOV     R4,#aExtendedAddress & 0xff
   \   000097   7D..         MOV     R5,#(aExtendedAddress >> 8) & 0xff
   \   000099   7AE8         MOV     R2,#-0x18
   \   00009B   7B07         MOV     R3,#0x7
   \   00009D   797F         MOV     R1,#0x7f
   \   00009F   12....       LCALL   ??HalFlashRead?relay
   \   0000A2   7402         MOV     A,#0x2
   \   0000A4   12....       LCALL   ?DEALLOC_XSTACK8
    233          
    234              if (osal_memcmp(aExtendedAddress, nullAddr, Z_EXTADDR_LEN))
   \   0000A7                ; Setup parameters for call to function osal_memcmp
   \   0000A7   85..82       MOV     DPL,?XSP + 0
   \   0000AA   85..83       MOV     DPH,?XSP + 1
   \   0000AD   A982         MOV     R1,DPL
   \   0000AF   AA83         MOV     R2,DPH
   \   0000B1   89..         MOV     ?V0 + 0,R1
   \   0000B3   8A..         MOV     ?V0 + 1,R2
   \   0000B5   75..00       MOV     ?V0 + 2,#0x0
   \   0000B8   78..         MOV     R0,#?V0 + 0
   \   0000BA   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000BD   7C08         MOV     R4,#0x8
   \   0000BF   7D00         MOV     R5,#0x0
   \   0000C1   79..         MOV     R1,#aExtendedAddress & 0xff
   \   0000C3   7A..         MOV     R2,#(aExtendedAddress >> 8) & 0xff
   \   0000C5   7B00         MOV     R3,#0x0
   \   0000C7   12....       LCALL   ??osal_memcmp?relay
   \   0000CA   7403         MOV     A,#0x3
   \   0000CC   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CF   E9           MOV     A,R1
   \   0000D0   606A         JZ      ??zmain_ext_addr_2
    235              {
    236                // Attempt to read the extended address from the designated location in the Info Page.
    237                if (!osal_memcmp((uint8 *)(P_INFOPAGE+HAL_INFOP_IEEE_OSET), nullAddr, Z_EXTADDR_LEN))
   \   0000D2                ; Setup parameters for call to function osal_memcmp
   \   0000D2   78..         MOV     R0,#?V0 + 0
   \   0000D4   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000D7   7C08         MOV     R4,#0x8
   \   0000D9   7D00         MOV     R5,#0x0
   \   0000DB   790C         MOV     R1,#0xc
   \   0000DD   7A78         MOV     R2,#0x78
   \   0000DF   7B00         MOV     R3,#0x0
   \   0000E1   12....       LCALL   ??osal_memcmp?relay
   \   0000E4   7403         MOV     A,#0x3
   \   0000E6   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E9   E9           MOV     A,R1
   \   0000EA   701D         JNZ     ??zmain_ext_addr_3
    238                {
    239                  osal_memcpy(aExtendedAddress, (uint8 *)(P_INFOPAGE+HAL_INFOP_IEEE_OSET), Z_EXTADDR_LEN);
   \   0000EC                ; Setup parameters for call to function osal_memcpy
   \   0000EC   75..0C       MOV     ?V0 + 0,#0xc
   \   0000EF   75..78       MOV     ?V0 + 1,#0x78
   \   0000F2   78..         MOV     R0,#?V0 + 0
   \   0000F4   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000F7   7C08         MOV     R4,#0x8
   \   0000F9   7D00         MOV     R5,#0x0
   \   0000FB   7A..         MOV     R2,#aExtendedAddress & 0xff
   \   0000FD   7B..         MOV     R3,#(aExtendedAddress >> 8) & 0xff
   \   0000FF   12....       LCALL   ??osal_memcpy?relay
   \   000102   7403         MOV     A,#0x3
   \   000104   12....       LCALL   ?DEALLOC_XSTACK8
   \   000107   8033         SJMP    ??zmain_ext_addr_2
    240                }
    241                else  // No valid extended address was found.
    242                {
    243                  uint8 idx;
    244                  
    245          #if !defined ( NV_RESTORE )
    246                  writeNV = FALSE;  // Make this a temporary IEEE address
    247          #endif
    248          
    249                  /* Attempt to create a sufficiently random extended address for expediency.
    250                   * Note: this is only valid/legal in a test environment and
    251                   *       must never be used for a commercial product.
    252                   */
    253                  for (idx = 0; idx < (Z_EXTADDR_LEN - 2);)
   \                     ??zmain_ext_addr_3:
   \   000109   7E00         MOV     R6,#0x0
    254                  {
    255                    uint16 randy = osal_rand();
   \                     ??zmain_ext_addr_4:
   \   00010B                ; Setup parameters for call to function osal_rand
   \   00010B   12....       LCALL   ??osal_rand?relay
   \   00010E   8A..         MOV     ?V0 + 0,R2
   \   000110   A8..         MOV     R0,?V0 + 0
    256                    aExtendedAddress[idx++] = LO_UINT16(randy);
   \   000112   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000115   E8           MOV     A,R0
   \   000116   F0           MOVX    @DPTR,A
   \   000117   0E           INC     R6
    257                    aExtendedAddress[idx++] = HI_UINT16(randy);
   \   000118   12....       LCALL   ?Subroutine1 & 0xFFFF
    258                  }
   \                     ??CrossCallReturnLabel_1:
   \   00011B   EB           MOV     A,R3
   \   00011C   F0           MOVX    @DPTR,A
   \   00011D   0E           INC     R6
   \   00011E   EE           MOV     A,R6
   \   00011F   C3           CLR     C
   \   000120   9406         SUBB    A,#0x6
   \   000122   40E7         JC      ??zmain_ext_addr_4
    259                  // Next-to-MSB identifies ZigBee devicetype.
    260          #if ZG_BUILD_COORDINATOR_TYPE && !ZG_BUILD_JOINING_TYPE
    261                  aExtendedAddress[idx++] = 0x10;
    262          #elif ZG_BUILD_RTRONLY_TYPE
    263                  aExtendedAddress[idx++] = 0x20;
    264          #else
    265                  aExtendedAddress[idx++] = 0x30;
   \   000124   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000127   7430         MOV     A,#0x30
   \   000129   F0           MOVX    @DPTR,A
    266          #endif
    267                  // MSB has historical signficance.
    268                  aExtendedAddress[idx] = 0xF8;
   \   00012A   7401         MOV     A,#0x1
   \   00012C   2E           ADD     A,R6
   \   00012D   F8           MOV     R0,A
   \   00012E   74..         MOV     A,#aExtendedAddress & 0xff
   \   000130   28           ADD     A,R0
   \   000131   F582         MOV     DPL,A
   \   000133   74..         MOV     A,#(aExtendedAddress >> 8) & 0xff
   \   000135   3400         ADDC    A,#0x0
   \   000137   F583         MOV     DPH,A
   \   000139   74F8         MOV     A,#-0x8
   \   00013B   F0           MOVX    @DPTR,A
    269                }
    270              }
    271          
    272              if (writeNV)
    273              {
    274                (void)osal_nv_write(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress);
   \                     ??zmain_ext_addr_2:
   \   00013C                ; Setup parameters for call to function osal_nv_write
   \   00013C   75....       MOV     ?V0 + 0,#aExtendedAddress & 0xff
   \   00013F   75....       MOV     ?V0 + 1,#(aExtendedAddress >> 8) & 0xff
   \   000142   78..         MOV     R0,#?V0 + 0
   \   000144   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000147   75..08       MOV     ?V0 + 0,#0x8
   \   00014A   75..00       MOV     ?V0 + 1,#0x0
   \   00014D   78..         MOV     R0,#?V0 + 0
   \   00014F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000152   7C00         MOV     R4,#0x0
   \   000154   7D00         MOV     R5,#0x0
   \   000156   7A01         MOV     R2,#0x1
   \   000158   7B00         MOV     R3,#0x0
   \   00015A   12....       LCALL   ??osal_nv_write?relay
   \   00015D   7404         MOV     A,#0x4
   \   00015F   12....       LCALL   ?DEALLOC_XSTACK8
    275              }
    276            }
    277          
    278            // Set the MAC PIB extended address according to results from above.
    279            (void)ZMacSetReq(MAC_EXTENDED_ADDRESS, aExtendedAddress);
   \                     ??zmain_ext_addr_1:
   \   000162                ; Setup parameters for call to function ZMacSetReq
   \   000162   7A..         MOV     R2,#aExtendedAddress & 0xff
   \   000164   7B..         MOV     R3,#(aExtendedAddress >> 8) & 0xff
   \   000166   79E2         MOV     R1,#-0x1e
   \   000168   12....       LCALL   ??ZMacSetReq?relay
    280          }
   \   00016B   7408         MOV     A,#0x8
   \   00016D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000170   7F03         MOV     R7,#0x3
   \   000172   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   8E..         MOV     ?V0 + 0,R6
   \   000002   74..         MOV     A,#aExtendedAddress & 0xff
   \   000004   25..         ADD     A,?V0 + 0
   \   000006   F582         MOV     DPL,A
   \   000008   74..         MOV     A,#(aExtendedAddress >> 8) & 0xff
   \   00000A   3400         ADDC    A,#0x0
   \   00000C   F583         MOV     DPH,A
   \   00000E   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgDefaultChannelList>`:
   \   000000   00080000     DD 2048

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgConfigPANID>`:
   \   000000   FFFF         DW 65535

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??main?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    main

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zmain_ext_addr?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zmain_ext_addr

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {255, 255, 255, 255, 255, 255, 255,`:
   \   000000   FF           DB 255
   \   000001   FF           DB 255
   \   000002   FF           DB 255
   \   000003   FF           DB 255
   \   000004   FF           DB 255
   \   000005   FF           DB 255
   \   000006   FF           DB 255
   \   000007   FF           DB 255

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "TexasInstruments">`:
   \   000000   54657861     DB "TexasInstruments"
   \            73496E73
   \            7472756D
   \            656E7473
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_800:
   \   000000   00080000     DD 2048
    281          
    282          #if defined ZCL_KEY_ESTABLISH
    283          /**************************************************************************************************
    284           * @fn          zmain_cert_init
    285           *
    286           * @brief       Initialize the Certicom certificate information.
    287           *
    288           * input parameters
    289           *
    290           * None.
    291           *
    292           * output parameters
    293           *
    294           * None.
    295           *
    296           * @return      None.
    297           **************************************************************************************************
    298           */
    299          static void zmain_cert_init(void)
    300          {
    301            uint8 certData[ZCL_KE_IMPLICIT_CERTIFICATE_LEN];
    302            uint8 nullData[ZCL_KE_IMPLICIT_CERTIFICATE_LEN] = {
    303              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    304              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    305              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    306              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    307              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    308              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
    309            };
    310          
    311            (void)osal_nv_item_init(ZCD_NV_IMPLICIT_CERTIFICATE, ZCL_KE_IMPLICIT_CERTIFICATE_LEN, NULL);
    312            (void)osal_nv_item_init(ZCD_NV_DEVICE_PRIVATE_KEY, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, NULL);
    313          
    314            // First check whether non-null certificate data exists in the OSAL NV. To save on code space,
    315            // just use the ZCD_NV_CA_PUBLIC_KEY as the bellwether for all three.
    316            if ((SUCCESS != osal_nv_item_init(ZCD_NV_CA_PUBLIC_KEY, ZCL_KE_CA_PUBLIC_KEY_LEN, NULL))    ||
    317                (SUCCESS != osal_nv_read(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, certData))  ||
    318                (osal_memcmp(certData, nullData, ZCL_KE_CA_PUBLIC_KEY_LEN)))
    319            {
    320              // Attempt to read the certificate data from its corresponding location on the lock bits page.
    321              HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_CA_PUBLIC_KEY_OSET, certData,
    322                                                   ZCL_KE_CA_PUBLIC_KEY_LEN);
    323              // If the certificate data is not NULL, use it to update the corresponding NV items.
    324              if (!osal_memcmp(certData, nullData, ZCL_KE_CA_PUBLIC_KEY_LEN))
    325              {
    326                (void)osal_nv_write(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, certData);
    327                HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_IMPLICIT_CERT_OSET, certData,
    328                                                     ZCL_KE_IMPLICIT_CERTIFICATE_LEN);
    329                (void)osal_nv_write(ZCD_NV_IMPLICIT_CERTIFICATE, 0,
    330                                    ZCL_KE_IMPLICIT_CERTIFICATE_LEN, certData);
    331                HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_DEV_PRIVATE_KEY_OSET, certData,
    332                                                  ZCL_KE_DEVICE_PRIVATE_KEY_LEN);
    333                (void)osal_nv_write(ZCD_NV_DEVICE_PRIVATE_KEY, 0, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, certData);
    334              }
    335            }
    336          }
    337          #endif
    338          
    339          /**************************************************************************************************
    340           * @fn          zmain_dev_info
    341           *
    342           * @brief       This displays the IEEE (MSB to LSB) on the LCD.
    343           *
    344           * input parameters
    345           *
    346           * None.
    347           *
    348           * output parameters
    349           *
    350           * None.
    351           *
    352           * @return      None.
    353           **************************************************************************************************
    354           */
    355          static void zmain_dev_info(void)
                             ^
Warning[Pe177]: function "zmain_dev_info" was declared but never referenced
    356          {
    357          #ifdef LCD_SUPPORTED
    358            uint8 i;
    359            uint8 *xad;
    360            uint8 lcd_buf[Z_EXTADDR_LEN*2+1];
    361          
    362            // Display the extended address.
    363            xad = aExtendedAddress + Z_EXTADDR_LEN - 1;
    364          
    365            for (i = 0; i < Z_EXTADDR_LEN*2; xad--)
    366            {
    367              uint8 ch;
    368              ch = (*xad >> 4) & 0x0F;
    369              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
    370              ch = *xad & 0x0F;
    371              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
    372            }
    373            lcd_buf[Z_EXTADDR_LEN*2] = '\0';
    374            HalLcdWriteString( "IEEE: ", HAL_LCD_LINE_1 );
    375            HalLcdWriteString( (char*)lcd_buf, HAL_LCD_LINE_2 );
    376          #endif
    377          }
    378          
    379          #ifdef LCD_SUPPORTED
    380          /*********************************************************************
    381           * @fn      zmain_lcd_init
    382           * @brief   Initialize LCD at start up.
    383           * @return  none
    384           *********************************************************************/
    385          static void zmain_lcd_init ( void )
    386          {
    387          #ifdef SERIAL_DEBUG_SUPPORTED
    388            {
    389              HalLcdWriteString( "TexasInstruments", HAL_LCD_LINE_1 );
    390          
    391          #if defined( MT_MAC_FUNC )
    392          #if defined( ZDO_COORDINATOR )
    393                HalLcdWriteString( "MAC-MT Coord", HAL_LCD_LINE_2 );
    394          #else
    395                HalLcdWriteString( "MAC-MT Device", HAL_LCD_LINE_2 );
    396          #endif // ZDO
    397          #elif defined( MT_NWK_FUNC )
    398          #if defined( ZDO_COORDINATOR )
    399                HalLcdWriteString( "NWK Coordinator", HAL_LCD_LINE_2 );
    400          #else
    401                HalLcdWriteString( "NWK Device", HAL_LCD_LINE_2 );
    402          #endif // ZDO
    403          #endif // MT_FUNC
    404            }
    405          #endif // SERIAL_DEBUG_SUPPORTED
    406          }
    407          #endif
    408          
    409          /*********************************************************************
    410          *********************************************************************/

   Maximum stack usage in bytes:

     Function               ISTACK PSTACK XSTACK
     --------               ------ ------ ------
     main                       0      0      4
       -> osal_int_disable      0      0      0
       -> HalAdcCheckVdd        0      0      0
       -> InitBoard             0      0      0
       -> HalDriverInit         0      0      0
       -> osal_nv_init          0      0      0
       -> osal_nv_item_len      0      0      0
       -> osal_nv_item_init     0      0      4
       -> osal_nv_read          0      0      8
       -> osal_nv_item_len      0      0      0
       -> osal_nv_item_init     0      0      4
       -> osal_nv_read          0      0      8
       -> osal_nv_item_len      0      0      0
       -> osal_nv_item_init     0      0      4
       -> osal_nv_read          0      0      8
       -> ZMacInit              0      0      0
       -> zmain_ext_addr        0      0      0
       -> zgInit                0      0      0
       -> osal_init_system      0      0      0
       -> osal_int_enable       0      0      0
       -> InitBoard             0      0      0
       -> HalLcdWriteString     0      0      0
       -> osal_start_system     0      0      0
     zmain_ext_addr             2      0     23
       -> osal_nv_item_init     0      0     42
       -> osal_nv_read          0      0     46
       -> osal_memcmp           0      0     44
       -> HalFlashRead          0      0     42
       -> osal_memcmp           0      0     44
       -> osal_memcmp           0      0     44
       -> osal_memcpy           0      0     44
       -> osal_rand             0      0     38
       -> osal_nv_write         0      0     46
       -> ZMacSetReq            0      0     38


   Segment part sizes:

     Function/Label                                 Bytes
     --------------                                 -----
     P0INP                                             1
     SLEEPSTA                                          1
     CLKCONSTA                                         1
     SLEEPCMD                                          1
     CLKCONCMD                                         1
     zgDefaultChannelList                              4
     zgConfigPANID                                     2
     start_flag                                        1
     main                                            359
     ?Subroutine0                                      2
     ??Subroutine4_0                                  14
     ?Subroutine3                                      2
     ??Subroutine5_0                                   6
     ?Subroutine2                                      2
     ??Subroutine6_0                                   6
     zmain_ext_addr                                  373
     ?Subroutine1                                     15
     ?<Initializer for zgDefaultChannelList>           4
     ?<Initializer for zgConfigPANID>                  2
     ??main?relay                                      6
     ??zmain_ext_addr?relay                            6
     ?<Constant {255, 255, 255, 255, 255, 255, 255,    8
     ?<Constant "TexasInstruments">                   17
     __Constant_800                                    4

 
 779 bytes in segment BANKED_CODE
  12 bytes in segment BANK_RELAYS
   5 bytes in segment SFR_AN
   6 bytes in segment XDATA_I
   6 bytes in segment XDATA_ID
  29 bytes in segment XDATA_ROM_C
   1 byte  in segment XDATA_Z
 
 797 bytes of CODE  memory
  25 bytes of CONST memory (+ 4 bytes shared)
   0 bytes of DATA  memory (+ 5 bytes shared)
   7 bytes of XDATA memory

Errors: none
Warnings: 1
